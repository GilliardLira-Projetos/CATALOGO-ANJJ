<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Admin - LOJA ANJJ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f4f4f9; padding: 20px; max-width: 800px; margin: auto; }
        .card-admin { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        button { cursor: pointer; font-weight: bold; border: none; }
        .btn-save { background: #16a34a; color: white; }
        .btn-edit { background: #facc15; color: #000; width: auto; padding: 5px 10px; margin: 0; }
        .btn-delete { background: #dc2626; color: white; width: auto; padding: 5px 10px; margin-left: 5px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; font-size: 13px; }
        th, td { border-bottom: 1px solid #eee; padding: 10px; text-align: left; }
        th { background: #f8fafc; }
        img { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; }
        #area-admin { display: none; }
    </style>
</head>
<body>

    <div id="area-login" class="card-admin">
        <h2>üîí Login Admin</h2>
        <input type="email" id="login-email" placeholder="E-mail">
        <input type="password" id="login-senha" placeholder="Senha">
        <button class="btn-save" onclick="fazerLogin()">Entrar</button>
    </div>

    <div id="area-admin">
        <div class="card-admin">
            <h2 id="form-title">Cadastrar Novo Produto</h2>
            <input type="hidden" id="prod-id"> <input type="text" id="nome" placeholder="Nome do Produto">
            <input type="number" id="preco" placeholder="Pre√ßo (Ex: 59.90)" step="0.01">
            <input type="text" id="categoria" placeholder="Categoria">
            <input type="text" id="tamanho" placeholder="Tamanho (P, M, G, √önico...)">
            <input type="text" id="cor" placeholder="Cor (Preto, Azul...)">
            <input type="number" id="estoque" placeholder="Quantidade em Estoque">
            <input type="text" id="imagem" placeholder="URL da Imagem">
            <select id="disponibilidade">
                <option value="show">Vis√≠vel no Site</option>
                <option value="hide">Escondido</option>
            </select>
            <button id="btn-acao" class="btn-save" onclick="salvarProduto()">Salvar Produto</button>
            <button id="btn-cancelar" style="display:none;" onclick="cancelarEdicao()">Cancelar Edi√ß√£o</button>
        </div>

        <div class="card-admin">
            <h3>Produtos Cadastrados</h3>
            <table>
                <thead>
                    <tr>
                        <th>Foto</th>
                        <th>Nome/Tam</th>
                        <th>Pre√ßo</th>
                        <th>Estoque</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="lista-produtos"></tbody>
            </table>
        </div>
        <button onclick="fazerLogout()" style="background:#666; color:white;">Sair</button>
    </div>

    <script>
        const SB_URL = "https://tjvscfmvhbhoirtasgae.supabase.co";
        const SB_KEY = "sb_publishable_fwcg-rT2Tvtyx5YnAMwBoA_ZL09xdQG";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        async function fazerLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-senha').value;
            const { error } = await _supabase.auth.signInWithPassword({ email, password });
            if (error) alert("Erro: " + error.message);
            else {
                document.getElementById('area-login').style.display = 'none';
                document.getElementById('area-admin').style.display = 'block';
                listarProdutos();
            }
        }

        async function listarProdutos() {
            const { data, error } = await _supabase.from('produtos').select('*').order('created_at', { ascending: false });
            if (error) return;
            const tbody = document.getElementById('lista-produtos');
            tbody.innerHTML = data.map(p => `
                <tr>
                    <td><img src="${p.Thumbnail || p.Image1}"></td>
                    <td><b>${p.Name}</b><br>${p.Variant_Name} | ${p.Tag}</td>
                    <td>R$ ${p.Price}</td>
                    <td>${p.Stock}</td>
                    <td>
                        <button class="btn-edit" onclick="prepararEdicao('${p.id}')">‚úèÔ∏è</button>
                        <button class="btn-delete" onclick="deletarProduto('${p.id}')">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        async function salvarProduto() {
            const id = document.getElementById('prod-id').value;
            const dados = {
                Name: document.getElementById('nome').value,
                Price: document.getElementById('preco').value,
                Category: document.getElementById('categoria').value,
                Variant_Name: document.getElementById('tamanho').value,
                Tag: document.getElementById('cor').value,
                Stock: parseInt(document.getElementById('estoque').value),
                Thumbnail: document.getElementById('imagem').value,
                Availability: document.getElementById('disponibilidade').value
            };

            let res;
            if (id) {
                // Se tem ID, ele ATUALIZA (Edit)
                res = await _supabase.from('produtos').update(dados).eq('id', id);
            } else {
                // Se n√£o tem ID, ele CRIA (New)
                res = await _supabase.from('produtos').insert([dados]);
            }

            if (res.error) alert("Erro: " + res.error.message);
            else {
                alert(id ? "Atualizado!" : "Cadastrado!");
                cancelarEdicao();
                listarProdutos();
            }
        }

        async function prepararEdicao(id) {
            const { data } = await _supabase.from('produtos').select('*').eq('id', id).single();
            document.getElementById('form-title').innerText = "Editando Produto";
            document.getElementById('prod-id').value = data.id;
            document.getElementById('nome').value = data.Name;
            document.getElementById('preco').value = data.Price;
            document.getElementById('categoria').value = data.Category;
            document.getElementById('tamanho').value = data.Variant_Name;
            document.getElementById('cor').value = data.Tag;
            document.getElementById('estoque').value = data.Stock;
            document.getElementById('imagem').value = data.Thumbnail;
            document.getElementById('disponibilidade').value = data.Availability;
            
            document.getElementById('btn-acao').innerText = "Salvar Altera√ß√µes";
            document.getElementById('btn-cancelar').style.display = 'block';
            window.scrollTo(0,0);
        }

        function cancelarEdicao() {
            document.getElementById('form-title').innerText = "Cadastrar Novo Produto";
            document.getElementById('prod-id').value = "";
            document.querySelectorAll('#area-admin input').forEach(i => i.value = "");
            document.getElementById('btn-acao').innerText = "Salvar Produto";
            document.getElementById('btn-cancelar').style.display = 'none';
        }

        async function deletarProduto(id) {
            if (confirm("Tem certeza que deseja excluir?")) {
                await _supabase.from('produtos').delete().eq('id', id);
                listarProdutos();
            }
        }

        function fazerLogout() { _supabase.auth.signOut(); location.reload(); }
    </script>
</body>
</html>
